<?xml version="1.0"?>
<robot name="pick_ball_mbot" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="$(find pick_ball_mbot_description)/urdf/pick_ball_mbot_base.xacro" />
    <xacro:include filename="$(find pick_ball_mbot_description)/urdf/sensors/kinect_gazebo.xacro" />
    <xacro:include filename="$(find pick_ball_mbot_description)/urdf/sensors/lidar_gazebo.xacro" />
    <xacro:include filename="$(find pick_ball_mbot_description)/urdf/joint_transmission_gazebo.xacro" />
    <xacro:include filename="$(find pick_ball_mbot_description)/urdf/paddle_gazebo.xacro" />


    <xacro:property name="wheel_mu" value="3"/>

        <!-- kinect -->
    <joint name="kinect_joint" type="fixed">
        <!--<origin xyz="-0.00214019 0.22491813 0.25000000" rpy="1.57079028 0 3.14159265" />-->
        <origin xyz="-0.0050 0.2250 0.251" rpy="0 0 1.5707" />
        <parent link="left_cover"/>
        <child link="kinect_link"/>
    </joint>
    <xacro:kinect_camera prefix="kinect"/>

    <!-- lidar -->
    <joint name="lidar_joint" type="fixed">
        <origin xyz="0 0 0.030" rpy="0 0 0" />
        <parent link="kinect_link"/>
        <child link="laser_link"/>
    </joint>
    <xacro:rplidar prefix="laser"/>

    <!-- paddle -->
    <joint name="paddle_joint" type="continuous">
        <origin xyz="0 0.22408 0.12" rpy="0.94075 0 3.1416" />
        <parent link="left_cover" />
        <child link="paddle" />
        <axis xyz="1 0 0" />
    </joint>
    <paddle_gazebo/>

    <pick_ball_mbot_base_gazebo/>
    
    <!--- design color for mbot -->
    <gazebo reference="left_cover">
        <material>Gazebo/Red</material>
    </gazebo>
    <gazebo reference="right_cover">
        <material>Gazebo/Red</material>
    </gazebo>
    <gazebo reference="base_link">
        <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="front_right_wheel">
        <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="front_left_wheel">
        <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="rear_right_wheel">
        <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="rear_left_wheel">
        <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="collector">
        <material>Gazebo/Wood</material>
    </gazebo>
    <gazebo reference="paddle">
        <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="support_rod">
        <material>Gazebo/Purple</material>
    </gazebo>

    <!-- friction -->
    <gazebo reference="front_left_wheel">
        <mu1>${wheel_mu}</mu1>
        <mu2>${wheel_mu}</mu2>
    </gazebo>

    <gazebo reference="front_right_wheel">
        <mu1>${wheel_mu}</mu1>
        <mu2>${wheel_mu}</mu2>
    </gazebo>

    <gazebo reference="rear_left_wheel">
        <mu1>${wheel_mu}</mu1>
        <mu2>${wheel_mu}</mu2>
    </gazebo>

    <gazebo reference="rear_right_wheel">
        <mu1>${wheel_mu}</mu1>
        <mu2>${wheel_mu}</mu2>
    </gazebo>

    <!-- design transmission for joint-->
    <joint_trans joint_name="front_right_wheel_joint"/>
    <joint_trans joint_name="front_left_wheel_joint"/>
    <!--<joint_trans joint_name="rear_right_wheel_joint"/>
    <joint_trans joint_name="rear_left_wheel_joint"/>-->
    <!--<joint_trans joint_name="paddle_joint"/>-->


    <gazebo>
        <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
            <rosDebugLevel>Debug</rosDebugLevel>
            <publishWheelTF>true</publishWheelTF>
            <robotNamespace>/</robotNamespace>
            <publishTf>1</publishTf>
            <publishWheelJointState>true</publishWheelJointState>
            <alwaysOn>true</alwaysOn>
            <updateRate>100.0</updateRate>
            <legacyMode>true</legacyMode>
            <leftJoint>front_left_wheel_joint</leftJoint>
            <rightJoint>front_right_wheel_joint</rightJoint>
            <wheelSeparation>0.12</wheelSeparation>
            <wheelDiameter>0.064</wheelDiameter>
            <broadcastTF>1</broadcastTF>
            <wheelTorque>30</wheelTorque>
            <wheelAcceleration>1.8</wheelAcceleration>
            <commandTopic>cmd_vel</commandTopic>
            <odometryFrame>odom</odometryFrame> 
            <odometryTopic>odom</odometryTopic> 
            <robotBaseFrame>base_footprint</robotBaseFrame>
        </plugin>
    </gazebo> 

    <!-- design controller for joint-->
    <!--<gazebo>
        <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
            <robotNamespace>/pick_ball_mbot</robotNamespace>
            <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
            <legacyModeNS>true</legacyModeNS>
            </plugin>
    </gazebo>-->

</robot>
